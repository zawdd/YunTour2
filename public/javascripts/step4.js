function countCharacters(n){var t=$(n).val().length;$(n).next().children().text(t)}$(document).ready(function(){$(".td-info").qtip({content:{attr:"title"},position:{my:"bottom left",at:"top right",adjust:{x:-15}},show:{event:"click",delay:0},events:{render:function(n,t){var i=t.elements.tip}},style:{tip:{corner:"bottom left",mimic:"bottom center",offset:20,width:11,height:7}}}),$(".inputsave label").qtip({content:{attr:"title"},position:{my:"bottom left",at:"top left",adjust:{x:-18}},show:{delay:0},events:{render:function(n,t){var i=t.elements.tip}},style:{tip:{corner:"bottom left",mimic:"bottom center",offset:20,width:11,height:7}}}),$(".forcounter").charCounter(),$(".selectdrop").selectBox(),$(".elastic").elastic(),$(".category-ddl").each(function(){$(this).data("suggestion",$("#CategoryID").data("suggestion"))})}),$(function(){$("#uc-drop").change(function(){$("#ul-drop").attr("disabled",!0).removeAttr("disabled"),$("#ul-drop").selectBox("enable")})});var initTrackChange=function(){$(".track-change").each(function(n,t){var i=$(t).attr("type")=="checkbox"?$(t).is(":checked"):$(t).val();$(t).data("initval",i),$(t).removeClass("input-changed"),$(t).unbind("change.tracking"),$(t).bind("change.tracking",function(){var i=$(t).attr("type")=="checkbox"?$(t).is(":checked"):$(t).val();i!=$(t).data("initval")?$(this).addClass("input-changed"):$(this).removeClass("input-changed"),$(".input-changed").length==0?($("#footerbtn-savechange, #footerbtn-discardchange").hide(),$("#footer-inside .large-button-action-next, #footer-inside .large-button-back").show()):($("#footerbtn-savechange, #footerbtn-discardchange").show(),$("#footer-inside .large-button-action-next, #footer-inside .large-button-back").hide())}),$(t).attr("type")!="hidden"&&$(t).attr("type")!="checkbox"&&($(t).unbind("keyup.tracking"),$(t).bind("keyup.tracking",function(){$(this).val()!=$(t).data("initval")?$(this).addClass("input-changed"):$(this).removeClass("input-changed"),$(".input-changed").length==0?($("#footerbtn-savechange, #footerbtn-discardchange").hide(),$("#footer-inside .large-button-action-next, #footer-inside .large-button-back").show()):($("#footerbtn-savechange, #footerbtn-discardchange").show(),$("#footer-inside .large-button-action-next, #footer-inside .large-button-back").hide())}))}),$("#footerbtn-savechange, #footerbtn-discardchange").hide(),$("#footer-inside .large-button-action-next, #footer-inside .large-button-back").show()};(function(n){n.genericPopup={version:"1.0",setDefaults:function(i){n.extend(t,i)}},n.fn.genericPopup=function(i){var r=this,u=!1,i=n.extend({},t,i,!n.metadata?{}:$input.metadata()),o=n(i.thumbHiddenField).val(),f,e,s;n("#generic-add-image").dialog({autoOpen:!1,height:450,width:720,resizable:!1,draggable:!0,position:["center","center"],open:function(){typeof jcrop_api_add_images!="undefined"&&(jcrop_api_add_images.destroy(),jcrop_api_add_images=undefined),n("#fromurl").val(""),n("#fromurl").removeAttr("disabled","disabled");n("#upload-photo-placeholder").attr("src","").hide().one("load",function(){n(this).show()});n("a.browse-action","#generic-add-image").addClass("medium-button-action"),n("a.medium-button-next","#generic-add-image").removeClass("medium-button-action").removeClass("medium-button-action-next").addClass("medium-button").addClass("medium-next-disabled")}}),n("#generic-thumb-crop").dialog({autoOpen:!1,height:530,width:720,resizable:!1,draggable:!0,position:["center","center"],open:function(){typeof jcrop_api_add_images=="undefined"&&(r.img=n("#generic-thumb-crop .crop-container img")[0],jcrop_api_add_images=n.Jcrop("#generic-thumb-crop .crop-container img",{onChange:r.showThumbPreview,onSelect:r.showThumbPreview,setSelect:[0,0,5e3,5e3],aspectRatio:1,bgColor:"#fff",boxWidth:400,boxHeight:258},function(){var n=this.getBounds();f=n[0],e=n[1],jcrop_api1=this,f>e?this.setSelect([0,0,e,e]):this.setSelect([0,0,f,f])}))},close:function(){}}),n("#generic-thumb-credits").dialog({autoOpen:!1,height:510,width:684,resizable:!1,draggable:!0,position:["center","center"]}),n("#generic-add-image .medium-button-action-cancel, #generic-thumb-crop .medium-button-action-cancel, #generic-thumb-credits .medium-button-action-cancel").unbind("click"),n("#generic-add-image .medium-button-action-cancel, #generic-thumb-crop .medium-button-action-cancel, #generic-thumb-credits .medium-button-action-cancel").bind("click",function(){return confirm(i.messageConfirmProgressLost,"",function(){n("#generic-add-image").dialog("close"),n("#generic-thumb-crop").dialog("close"),n("#generic-thumb-credits").dialog("close")}),!1}),n("#add-thumb").live("click",function(){var t,r,f;return o=n(i.thumbHiddenField).val(),o&&i.thumbShowCredits?(t=n(i.thumbCreditsHidden).val(),n("#generic-credits","#generic-thumb-credits").val(t).trigger("keyup"),t?n(".credits-label").html(i.editCreditsLabel):n(".credits-label").html(i.addCreditsLabel),r=n(i.thumbHiddenField).val(),f=baseUrl+"Image/DownloadImageForDevice/"+r+"/thumb/146",n("#generic-thumb-credits .preview img").attr("src",f),n("#generic-thumb-credits .preview img").css({width:"auto",height:"auto",marginLeft:"0px",marginTop:"0px"}),u=!0,n("#generic-thumb-credits").dialog("open"),n("#generic-thumb-credits").find(".medium-button-prev").children().html(i.changeLabel)):(n("#generic-add-image").dialog("open"),n("#generic-thumb-credits").find(".medium-button-prev").children().html(i.cropLabel),u=!1),!1}),n("#generic-add-image .medium-button-next").bind("click",function(){return n("#upload-photo-placeholder").attr("src")!=""&&(n("#generic-add-image").dialog("close"),n("#generic-thumb-crop").dialog("open")),!1}),n("#generic-thumb-crop .medium-button-prev").bind("click",function(){return n("#generic-thumb-crop").dialog("close"),n("#generic-add-image").dialog("open"),!1}),n("#generic-thumb-crop .medium-button-action-next").bind("click",function(){return n("#generic-thumb-crop").dialog("close"),i.thumbShowCredits?(n("#generic-thumb-credits").find(".medium-button-prev").children().html(i.cropLabel),n("#generic-thumb-credits").dialog("open")):r.cropImage(),!1}),n("#generic-thumb-credits .medium-button-prev").bind("click",function(){return n("#generic-thumb-credits").dialog("close"),u?(n("#generic-add-image").dialog("open"),u=!1):n("#generic-thumb-crop").dialog("open"),!1}),n("#generic-thumb-credits .medium-button-action-finish").bind("click",function(){n("#thumb-generic-form").submit()}),n("#fromurl").bind("blur",function(){if(n("#fromurl").val().indexOf("http")!=0){n("#fromurl").val(""),n("#upload-photo-placeholder").hide(),n("#upload-photo-placeholder").attr("src",""),n("a.browse-action","#generic-add-image").addClass("medium-button-action"),n("a.medium-button-next","#generic-add-image").removeClass("medium-button-action").removeClass("medium-button-action-next").addClass("medium-button").addClass("medium-next-disabled");return}}),n("#fromurl").bind("keyup",function(){var t=n("<img />");n("#upload-photo-placeholder").hide(),n("#upload-photo-placeholder").attr("src",""),t.load(function(){this.height!=0&&(n("#image-source").val(n("#fromurl").val()),n(".generic-image-preview").attr("src",n("#fromurl").val()),n("#upload-photo-placeholder").show(),n("a.browse-action","#generic-add-image").addClass("medium-button").removeClass("medium-button-action"),n("a.medium-button-next","#generic-add-image").addClass("medium-button-action").addClass("medium-button-action-next").removeClass("medium-button").removeClass("medium-next-disabled"))}),t.attr("src",n("#fromurl").val())}),n("#thumb-generic-form").submit(function(t){n(this).valid()&&r.validForm(),t.preventDefault()}),this.validForm=function(){n("#generic-thumb-credits").dialog("close"),u?(n(i.thumbCreditsHidden).val(n("#generic-credits","#generic-thumb-credits").val()),n(i.thumbCreditsHidden).trigger("change")):r.cropImage(),n("#add-thumb").children().first().html(i.editImageLabel),n("#add-thumb").parent().addClass("not-empty")},this.cropImage=function(){showLoading("Cropping, please wait"),n.ajax({url:baseUrl+"Image/CropThumbnail/",type:"POST",async:!0,data:{userID:userID,source:n("#image-source").val(),x:n("#thumb-x").val(),y:n("#thumb-y").val(),h:n("#thumb-h").val(),w:n("#thumb-w").val()},success:function(t){var r=baseUrl+"Image/DownloadImageForDevice/"+t.name+"/thumb/146";n(i.thumbHiddenField).val(t.name).trigger("change"),n(i.thumbHiddenField).closest("form").validate().element(i.thumbHiddenField),n(i.thumbContainer).css("background-image","url('"+r+"')"),i.thumbCreditsHidden&&n(i.thumbCreditsHidden).val(n("#generic-credits","#generic-thumb-credits").val())},error:function(n,t,i){alert(n.status),alert(i)},complete:function(){hideLoading()}})},this.showThumbPreview=function(t){n("#thumb-x").val(t.x),n("#thumb-y").val(t.y),n("#thumb-w").val(t.w),n("#thumb-h").val(t.h);var i=200/t.w,u=200/t.h;n("#generic-thumb-crop .preview img, #generic-thumb-credits .preview img").css({width:Math.round(i*r.img.width)+"px",height:Math.round(u*r.img.height)+"px",marginLeft:"-"+Math.round(i*t.x)+"px",marginTop:"-"+Math.round(u*t.y)+"px"})},n("#generic_file_upload").uploadify({uploader:baseUrl+"Scripts/swf/uploadify.swf",script:baseUrl+"Image/Upload",scriptData:{userID:userID,prefix:i.thumbPrefix},cancelImg:baseUrl+"Content/images/cancel.png",buttonText:"Browse files",folder:"uploads",auto:!0,width:126,height:42,wmode:"transparent",hideButton:!0,fileExt:"*.jpeg;*.gif;*.png;*.jpg;*.bmp",fileDesc:"Image Files",onComplete:function(t,r,f,e){info(i.messageSucceedUpload),u=!1,result=n.parseJSON(e),n("#image-source").val(result.name);var s=baseUrl+"Image/DownloadImageForDevice/"+result.name+"/temp/0";n(".generic-image-preview").attr("src",s),n("#upload-photo-placeholder").show(),n("#generic-add-image .drop-zone .filename").empty().html(f.name),n("#fromurl").attr("disabled","disabled"),n("a.browse-action","#generic-add-image").addClass("medium-button").removeClass("medium-button-action"),n("a.medium-button-next","#generic-add-image").addClass("medium-button-action").addClass("medium-button-action-next").removeClass("medium-button").removeClass("medium-next-disabled")}}),n.isFunction(i.init)&&i.init.apply(r,[$input,i])};var t={thumbPrefix:"author-pic",thumbContainer:"#image-thumb",thumbHiddenField:"#Photo",thumbShowCredits:!1,thumbCreditsHidden:null,changeLabel:"Change thumbnail",cropLabel:"Crop thumbnail",addImageLabel:"Add image",editImageLabel:"Edit image",addCreditsLabel:"Add credits <span>(optional)<\/span>",editCreditsLabel:"Edit credits",browseLabel:"Browse file",messageConfirmProgressLost:"Are you sure?",messageSucceedUpload:""}})(jQuery),$().ready(function(){})